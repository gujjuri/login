
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title></title>
</head>
<body>
  <div id="content">  
    <iframe onload="frameLoad()" onreadystatechange="frameLoad()" height="400" width="600"
    src="https://script.google.com/macros/s/AKfycbzK8Kl7ru2Kqdz4hskC7cL0fYQeyhFua2Gbn6AYCRP3nn00Y-U/exec"
     sandbox="allow-scripts allow-popups allow-forms">Loading
  </iframe>
  <script>
    const main  = (() => {
      console.log("loading page");
      const f = document.querySelector("iframe");
      f.onload = (e) => {
        console.log("iframe onload");
        const fw = f.contentWindow;
        if (fw.length > 0) console.info("logged in");
        else {
          alert("Please Login!");
          window.location = "https://accounts.google.com";
        }
      };
    })();
    
    
var prevent_bust = false ;
    var from_loading_204 = false;
    var frame_loading = false;
    var prevent_bust_timer = 0;
    var  primer = true;
    window.onbeforeunload = function(event) {
        prevent_bust = !from_loading_204 && frame_loading;
        if(from_loading_204)from_loading_204 = false;
        if(prevent_bust){
            prevent_bust_timer=500;
        }
    }
    function frameLoad(){
        if(!primer){
            from_loading_204 = true;
            window.top.location = '/?204';
            prevent_bust = false;
            frame_loading = true;
            prevent_bust_timer=1000;
        }else{
            primer = false;
        }
    }
    setInterval(function() {  
        if (prevent_bust_timer>0) {  
            if(prevent_bust){
                from_loading_204 = true;
                window.top.location = '/?204';
                prevent_bust = false;
            }else if(prevent_bust_timer == 1){
                frame_loading = false;
                prevent_bust = false;
                from_loading_204 = false;
                prevent_bust_timer == 0;
            }



        }
        prevent_bust_timer--;
        if(prevent_bust_timer==-100) {
            prevent_bust_timer = 0;
        }
    }, 1);

    
  </script>

  </div>
</body>
</html>

<!-- !DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Test Layout</title>
        <style type="text/css">
            body, html
            {
                margin: 0; padding: 0; height: 100%; overflow: hidden;
            }

            #content
            {
                position:absolute; left: 0; right: 0; bottom: 0; top: 0px; widows: 800px; height:1000px;
            }
        </style> 
    </head>
    <body>
        <div id="content">  
          <iframe
          src="https://script.google.com/macros/s/AKfycbxo-MQZgzllPWWw3zszQEtAOPxM_dBzKzhzHGojnHpn5PjGE0Q/exec"
          >Loading
        </iframe>
        <script>
          const main = (() => {
            console.log("loading page");
            const f = document.querySelector("iframe");
            f.onload = (e) => {
              console.log("iframe onload");
              const fw = f.contentWindow;
              if (fw.length > 0) console.info("logged in");
              else {
                alert("Please Login!");
                window.location = "https://accounts.google.com";
              }
            };
          })();
        </script>

        </div>
    </body>
</html> -->
